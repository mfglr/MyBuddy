{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },

  "IdentityOptions": {
    "Issuer": "http://localhost:8080/realms/AppTenant",
    "BaseUrl": "http://localhost:8080/realms/AppTenant",
    "Audience": "gateway"
  },

  "ReverseProxy": {

    "Routes": {

      "account-login-route": {
        "ClusterId": "account.cluster",
        "Match": {
          "Path": "accounts/login"
        },
        "Transforms": [
          {
            "PathPattern": "/realms/AppTenant/protocol/openid-connect/token"
          }
        ]
      },
      "account-loginByRefreshToken-route": {
        "ClusterId": "account.cluster",
        "Match": {
          "Path": "accounts/loginByRefreshToken"
        },
        "Transforms": [
          {
            "PathPattern": "/realms/AppTenant/protocol/openid-connect/token"
          }
        ]
      },
      "account-logout-route": {
        "ClusterId": "account.cluster",
        "Match": {
          "Path": "accounts/logout"
        },
        "Transforms": [
          {
            "PathPattern": "/realms/AppTenant/protocol/openid-connect/logout"
          }
        ],
        "AuthorizationPolicy": "user"
      },

      "query-post-route": {
        "ClusterId": "query.cluster",
        "Match": {
          "Path": "{version:regex(^v[0-9]+$)}/posts/{**catch-all}"
        },
        "Transforms": [
          {
            "PathPattern": "/api/{version:regex(^v[0-9]+$)}/posts/{**catch-all}"
          }
        ]
      },

      "user-create-route": {
        "ClusterId": "user.cluster",
        "Match": {
          "Path": "{version:regex(^v[0-9]+$)}/users/create"
        },
        "Transforms": [
          {
            "PathPattern": "api/{version:regex(^v[0-9]+$)}/users/create"
          }
        ]
      },
      "user-get-write-model-by-id-route": {
        "ClusterId": "user.cluster",
        "Match": {
          "Path": "{version:regex(^v[0-9]+$)}/users/GetWriteModelById/{id}"
        },
        "Transforms": [
          {
            "PathPattern": "api/{version:regex(^v[0-9]+$)}/users/GetWriteModelById/{id}"
          }
        ]
      },
      "user-create-media-route": {
        "ClusterId": "user.cluster",
        "Match": {
          "Path": "{version:regex(^v[0-9]+$)}/users/createMedia"
        },
        "Transforms": [
          {
            "PathPattern": "api/{version:regex(^v[0-9]+$)}/users/createMedia"
          }
        ],
        "AuthorizationPolicy": "user"
      },
      "user-sendEmailVerificationMail-route": {
        "ClusterId": "user.cluster",
        "Match": {
          "Path": "{version:regex(^v[0-9]+$)}/users/SendEmailVerificationMail"
        },
        "Transforms": [
          {
            "PathPattern": "api/{version:regex(^v[0-9]+$)}/users/SendEmailVerificationMail"
          }
        ],
        "AuthorizationPolicy": "user"
      },
      "user-update-name-route": {
        "ClusterId": "user.cluster",
        "Match": {
          "Path": "{version:regex(^v[0-9]+$)}/users/updateName"
        },
        "Transforms": [
          {
            "PathPattern": "api/{version:regex(^v[0-9]+$)}/users/updateName"
          }
        ],
        "AuthorizationPolicy": "user"
      },

      "user-query-route": {
        "ClusterId": "user-query.cluster",
        "Match": {
          "Path": "{version:regex(^v[0-9]+$)}/users/{**catch-all}"
        },
        "Transforms": [
          {
            "PathPattern": "api/{version:regex(^v[0-9]+$)}/users/{**catch-all}"
          }
        ]
      },

      "post-get-write-model-by-id-route": {
        "ClusterId": "post.cluster",
        "Match": {
          "Path": "{version:regex(^v[0-9]+$)}/posts/GetWriteModelById/{id}"
        },
        "Transforms": [
          {
            "PathPattern": "/api/{version:regex(^v[0-9]+$)}/posts/GetById/{id}"
          }
        ]
      },
      "post-create-route": {
        "ClusterId": "post.cluster",
        "Match": {
          "Path": "{version:regex(^v[0-9]+$)}/posts/create"
        },
        "Transforms": [
          {
            "PathPattern": "/api/{version:regex(^v[0-9]+$)}/posts/create"
          }
        ],
        "AuthorizationPolicy": "user"
      },
      "post-update-content-route": {
        "ClusterId": "post.cluster",
        "Match": {
          "Path": "{version:regex(^v[0-9]+$)}/posts/updateContent"
        },
        "Transforms": [
          {
            "PathPattern": "/api/{version:regex(^v[0-9]+$)}/posts/updateContent"
          }
        ],
        "AuthorizationPolicy": "user"
      },
      "post-delete-route": {
        "ClusterId": "post.cluster",
        "Match": {
          "Path": "{version:regex(^v[0-9]+$)}/posts/delete/{id}"
        },
        "Transforms": [
          {
            "PathPattern": "/api/{version:regex(^v[0-9]+$)}/posts/delete/{id}"
          }
        ],
        "AuthorizationPolicy": "adminOrUser"
      },
      "post-restore-route": {
        "ClusterId": "post.cluster",
        "Match": {
          "Path": "{version:regex(^v[0-9]+$)}/posts/restore"
        },
        "Transforms": [
          {
            "PathPattern": "/api/{version:regex(^v[0-9]+$)}/posts/restore"
          }
        ],
        "AuthorizationPolicy": "admin"
      },
      "post-get-by-user-id-route": {
        "ClusterId": "post-query.cluster",
        "Match": {
          "Path": "{version:regex(^v[0-9]+$)}/posts/GetByUserId"
        },
        "Transforms": [
          {
            "PathPattern": "/api/{version:regex(^v[0-9]+$)}/posts/GetByUserId"
          }
        ]
      },

      "blob-get-route": {
        "ClusterId": "blob.cluster",
        "Match": {
          "Path": "{version:regex(^v[0-9]+$)}/blobs/get/{containerName}/{blobName}"
        },
        "Transforms": [
          {
            "PathPattern": "/api/{version:regex(^v[0-9]+$)}/blobs/get/{containerName}/{blobName}"
          }
        ],
        "AuthorizationPolicy": "media-read"
      },

      "message-route": {
        "ClusterId": "message.cluster",
        "Match": {
          "Path": "{version:regex(^v[0-9]+$)}/messages/{**catch-all}"
        },
        "Transforms": [
          {
            "PathPattern": "api/{version:regex(^v[0-9]+$)}/messages/{**catch-all}"
          }
        ],
        "AuthorizationPolicy": "user"
      },

      "realtime-route": {
        "ClusterId": "realtime.cluster",
        "Match": {
          "Path": "/realtime/{**catch-all}"
        },
        "AuthorizationPolicy": "user"
      },

      "post-like-route": {
        "ClusterId": "post-like.cluster",
        "Match": {
          "Path": "{version:regex(^v[0-9]+$)}/postlikes/{**catch-all}"
        },
        "Transforms": [
          {
            "PathPattern": "api/{version:regex(^v[0-9]+$)}/postlikes/{**catch-all}"
          }
        ],
        "AuthorizationPolicy": "user"
      }
    },

    "Clusters": {

      "account.cluster": {
        "Destinations": {
          "destination": {
            "Address": "http://localhost:8080"
          }
        }
      },

      "user.cluster": {
        "Destinations": {
          "destination": {
            "Address": "http://localhost:5283"
          }
        }
      },

      "user-query.cluster": {
        "Destinations": {
          "destination": {
            "Address": "http://localhost:5136"
          }
        }
      },

      "post.cluster": {
        "Destinations": {
          "destination": {
            "Address": "http://localhost:5237"
          }
        }
      },

      "post-query.cluster": {
        "Destinations": {
          "destination": {
            "Address": "http://localhost:5024"
          }
        }
      },

      "blob.cluster": {
        "Destinations": {
          "destination": {
            "Address": "http://localhost:5284"
          }
        }
      },

      "message.cluster": {
        "Destinations": {
          "destination": {
            "Address": "http://localhost:5049"
          }
        }
      },

      "realtime.cluster": {
        "Destinations": {
          "destination": {
            "Address": "http://localhost:5228"
          }
        }
      },

      "post-like.cluster": {
        "Destinations": {
          "destination": {
            "Address": "http://localhost:5201"
          }
        }
      }
    }
  }
}
